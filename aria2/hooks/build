#!/usr/bin/env sh

set -x

case "${DOCKER_TAG}" in
    '1.34')
        ARIA_VERSION='tags/release-1.34.0'
        set -- --tag "${DOCKER_REPO}:latest" --target static
        ;;
    '1.34-busybox')
        ARIA_VERSION='tags/release-1.34.0'
        set -- --tag "${DOCKER_REPO}:busybox" --target embedded
        ;;
    'edge')
        ARIA_VERSION='master'
        set -- --target static
        ;;
    'edge-busybox')
        ARIA_VERSION='master'
        set -- --target embedded
        ;;
esac

docker build \
    --file "${DOCKERFILE_PATH}" \
    --build-arg aria_version="${ARIA_VERSION}" \
    --tag "${IMAGE_NAME}" \
    "$@" \
    .
